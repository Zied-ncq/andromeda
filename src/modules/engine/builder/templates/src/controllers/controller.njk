import  {AndromedaLogger} from "../config/andromeda-logger.js";
const Logger = AndromedaLogger;

class {{ ControllerClassName }} {

    static start = async (req, res) => {

        try {
            let variables = {};
            if(req.body && req.body.variables){
                variables = JSON.parse(req.body.variables);
            }

            if(req.files){
                Object.keys(req.files).forEach( (file) => {
                Logger.debug(`storing file ${file} in persistent storage`);
                });
            }
            if(!req.params.processDef){
                throw new Error(`Process identifier processDef is required`)
            }

            if(req.params.processDef === '{{ startMethod.name }}'){
                const processInstance = await {{ startMethod.name }}ProcessInstanceService.createInstance();
                await processInstance.bootstrap(variables);
                res.status(200)
                res.send({id: processInstance.processInstanceId})
            }
            res.status(404)
            res.send("cannot find processDef")

        } catch (err) {
            Logger.error(err)
            const returnError = new Error();
            returnError.statusCode = 500;
            returnError.message = err;
            returnError.stack=err;
            res.status(500)
            res.send(returnError)
            throw returnError;
        }
    }
}

export default {{ ControllerClassName }};